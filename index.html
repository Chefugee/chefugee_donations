<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Chefugee donations">
    <link rel="icon" href="imgs/icon.png" sizes="32x32">
    <title>Chefugee Donations</title>
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/pure-min.css" integrity="sha384-"
        crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">


    <!--[if lte IE 8]>
        <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/grids-responsive-old-ie-min.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/grids-responsive-min.css">
    <!--<![endif]-->


    <!--[if lte IE 8]>
            <link rel="stylesheet" href="css/layouts/pricing-old-ie.css">
        <![endif]-->
    <!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="css/layouts/pricing.css">
    <!--<![endif]-->
    <link rel="stylesheet" href="css/style.css">
    <script src="https://js.stripe.com/v3"></script>
</head>

<body>

    <div class="pure-menu pure-menu-horizontal">
        <a href="#" class="pure-menu-heading"><img src="imgs/icon.png" height="50px" alt="logo"></a>
    </div>

    <div class="l-content">
        <div style="margin: 0 auto; width: 600px; text-align: center; display: none;" id="thankYou">
            <p data-i18n="message-thankyou">Gracias por tu generosidad! Si quieres cambiar el importe de futuras donaciones o cancelar tu donación mensual, por favor escribe a food@chefugee.com</p>
        </div>
        <div class="pricing-tables">
            <div class="pure-u-1 pure-u-md-1-4">
                <div class="pricing-table" style="animation-delay: 0s">
                    <div class="pricing-table-header -a">
                        <h2 data-i18n="text-recurring">Recurrente</h2>

                        <span class="pricing-table-price">
                            5€ <span data-i18n="text-monthly">al mes</span>
                        </span>
                    </div>

                    <button class="button-choose pure-button checkout-button"
                        data-plan="plan_FXNNNH3k8CpFUF" role="link">
                        donar
                    </button>
                </div>
            </div>

            <div class="pure-u-1 pure-u-md-1-4">
                <div class="pricing-table" style="animation-delay: 0.2s">
                    <div class="pricing-table-header -b">
                        <h2 data-i18n="text-recurring">Recurrente</h2>

                        <span class="pricing-table-price">
                            15€ <span data-i18n="text-monthly">al mes</span>
                        </span>
                    </div>

                    <button class="button-choose pure-button checkout-button"
                        data-plan="plan_FXNOUJKfRfzc0S" role="link">
                        donar
                    </button>
                </div>
            </div>

            <div class="pure-u-1 pure-u-md-1-4">
                <div class="pricing-table pricing-table-enterprise" style="animation-delay: 0.3s">
                    <div class="pricing-table-header -c">
                        <h2 data-i18n="text-recurring">Recurrente</h2>

                        <span class="pricing-table-price">
                            25€ <span data-i18n="text-monthly">al mes</span>
                        </span>
                    </div>

                    <button class="button-choose pure-button checkout-button"
                        data-plan="plan_FXNOi208wJMFhG" role="link">
                        donar
                    </button>
                </div>
            </div>

            <div class="pure-u-1 pure-u-md-1-4">
                <div class="pricing-table pricing-table-enterprise" style="animation-delay: 0.4s">
                    <div class="pricing-table-header -d">
                        <h2 data-i18n="text-onetime-donations">Donar una vez</h2>

                        <span class="pricing-table-price">
                            € <span data-i18n="text-once">una vez</span>
                        </span>
                    </div>

                    <form class="pure-form pure-form-stacked">
                    <legend data-i18n="text-howmuch">¿Cuanto te gustaria donar?</legend>
                    <input id="amount-input" type="number" value="1" autocomplete="off"
                        style="display: inline-block; margin-right: 3px"><span>€</span>
                    </form>
                    <button class="pure-button" id="donate-button" data-product="sku_FXNMGG322S5Kmc" role="link" data-i18n="text-donate">
                        donar
                    </button>

                </div>
            </div>
        </div> <!-- end pricing-tables -->
        <div style="margin: 0 auto; width: 600px; text-align: center;">
            <p><span data-i18n="message-bankaccount">También puedes hacer una transferencia a </span> <b>ES55 2085 9254 1503 3055 3947</b></p>
        </div>
        <div style="margin: 0 auto; width: 300px; text-align: center;" id="error-message"></div>


    </div> <!-- end l-content -->

    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="js/lib/CLDRPluralRuleParser/CLDRPluralRuleParser.js"></script>
    <script src="js/lib/jquery.i18n.js"></script>
    <script src="js/lib/jquery.i18n.messagestore.js"></script>
    <script src="js/lib/jquery.i18n.fallbacks.js"></script>
    <script src="js/lib/jquery.i18n.language.js"></script>
    <script src="js/lib/jquery.i18n.parser.js"></script>
    <script src="js/lib/jquery.i18n.emitter.js"></script>
    <script src="js/lib/jquery.i18n.emitter.bidi.js"></script>
    <script>
        $.i18n().load( {
            en: 'js/lib/languages/en.json',
            es: 'js/lib/languages/es.json'
        } );
        $.i18n().locale = navigator.language;

        $(window).on('load',function(){
            $('body').i18n();
        })
    </script>
    <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
    <script>
        var stripe = Stripe('pk_live_m3HxbTrPdllNXdFtso9NwDgf00ZZPxj21S');

        var donateButton = document.getElementById('donate-button');
        donateButton.addEventListener('click', function (event) {
            event.preventDefault();
            var targetElement = event.target || event.srcElement;
            // When the customer clicks on the button, redirect
            // them to Checkout.
            stripe.redirectToCheckout({
                items: [{ sku: targetElement.dataset.product, quantity: parseInt(document.getElementById('amount-input').value) }],
                locale: navigator.language,
                submitType: 'donate',

                // Do not rely on the redirect to the successUrl for fulfilling
                // purchases, customers may not always reach the success_url after
                // a successful payment.
                // Instead use one of the strategies described in
                // https://stripe.com/docs/payments/checkout/fulfillment
                successUrl: 'https://donations.chefugee.org?success=true',
                cancelUrl: 'https://donations.chefugee.org?cancel=true',
            })
                .then(function (result) {
                    alert(result)
                    if (result.error) {
                        // If `redirectToCheckout` fails due to a browser or network
                        // error, display the localized error message to your customer.
                        var displayError = document.getElementById('error-message');
                        displayError.textContent = result.error.message;
                    }
                });
        });

        var checkoutButtons = document.getElementsByClassName('checkout-button')
        for (var i = 0; i < checkoutButtons.length; i++) {
            checkoutButtons[i].addEventListener('click', function (event) {
                var targetElement = event.target || event.srcElement;
                // When the customer clicks on the button, redirect
                // them to Checkout.
                stripe.redirectToCheckout({
                    items: [{ plan: targetElement.dataset.plan, quantity: 1 }],
                    locale: 'es',

                    // Do not rely on the redirect to the successUrl for fulfilling
                    // purchases, customers may not always reach the success_url after
                    // a successful payment.
                    // Instead use one of the strategies described in
                    // https://stripe.com/docs/payments/checkout/fulfillment
                    successUrl: 'https://donations.chefugee.org?success=true',
                    cancelUrl: 'https://donations.chefugee.org?cancel=true',
                })
                    .then(function (result) {
                        if (result.error) {
                            alert(result.error.message)
                            // If `redirectToCheckout` fails due to a browser or network
                            // error, display the localized error message to your customer.
                            var displayError = document.getElementById('error-message');
                            displayError.textContent = result.error.message;
                        }
                    });
            });
        }

        function getUrlVars() {
            var vars = {};
            var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {
                vars[key] = value;
            });
            return vars;
        }

        function getUrlParam(parameter, defaultvalue) {
            var urlparameter = defaultvalue;
            if (window.location.href.indexOf(parameter) > -1) {
                urlparameter = getUrlVars()[parameter];
            }
            return urlparameter;
        }
        var success = getUrlParam('success')
        if (success == 'true') {
            $("#thankYou").show()
        }

    </script>
</body>

</html>